{"version":3,"sources":["webpack:///./src/index.ts?eac3","webpack:///webpack/universalModuleDefinition?5ca6","webpack:///webpack/bootstrap 803d7c0fcd23ef68ea76?b25d","webpack:///./src/helpers/lineHeight.ts?3e5b","webpack:///./src/helpers/fontInfo.ts?1e8d","webpack:///./src/helpers/index.ts?8dc3","webpack:///./src/helpers/widthsHeights.ts?0b2f","webpack:///./src/lru/index.ts?a7ca"],"names":[],"mappings":"eA8CgB,KAAM,MC9CtB,cACA,2BACA,uCACA,sCACA,cACA,GACA,+CAEA,oBACA,GAAC,mBACD,kBCTA,cAMA,MACA,eAGA,mBACA,GACA,EACA,KAIA,mDAGA,KAGA,OACA,OAIA,IAzBA,iBA4BA,MAGA,iBAA2C,OAAc,EAGzD,qBACA,OACA,8BACA,CACA,gBACA,kBAGA,GAGA,iBACA,YACA,qBAA2B,UAA0B,UACrD,YAAiC,OAAe,EAChD,mBACA,GACA,CAGA,mBAAsD,+CAA+D,EAGrH,MAGA,6CClDA,YACM,CAAe,IACE,KACX,SAAK,KAAY,YAE7B,GAEA,KAOqE,cAC7D,MAAyB,GAAW,EAC5C,EAAC,UA7BD,GAAoB,EAAW,SAAc,cAAQ,OACrC,EAAM,MAAS,SAAc,WAC7B,EAAM,MAAI,IAAS,MACnB,EAAM,MAAK,KAAS,MACpB,EAAM,MAAW,WAAY,SAC7B,EAAM,MAAO,OAAU,OACvB,EAAM,MAAM,MAAU,OACtB,EAAM,MAAO,OAAW,QACxB,EAAU,UAAO,IAEzB,SAAiB,iBAAmB,mBAAQ,GACpD,GAAwB,MASM,EAAG,IAAgB,UAAsC,cAI/E,MAHC,KACS,EAAM,MAAW,WAAc,EAC/B,EAAM,MAAS,SAAW,EAAQ,KAC3B,EAAa,aACtC,CAAG,iCHYqE,gBAEpE,QAAW,YACX,IAAS,UACT,IAAW,YACX,IAAa,cACb,IAEF,SAAO,aACP,GAAQ,EAAa,WAAK,KAAI,UAAJ,MAAc,EAAa,EAAe,UAAe,EAAI,IAAE,YAAI,MAAQ,GAAI,CAAI,MAC1G,GAAI,GAAQ,GAAoB,EAAW,OAAU,GAAU,SAAW,KACrE,MAAK,MAAI,IAAI,EAErB,QAAU,EAAO,GAAkB,CAAV,GAAM,GAAO,CACpC,GAAc,GAAO,EAAQ,CAAZ,GACd,EAAiB,EAAW,OAAU,GAAU,SAAK,KACnD,EAEC,EACA,EAER,CAAC,CACK,MACR,EAAC,CAEwE,gBACjE,QACN,UAAU,EAAG,IAAc,KAAW,EAAQ,GACxC,MAAW,EAAJ,IAAc,GAC7B,CAAC,wEA9D2E,aAAlB,cACrC,MAEjB,QAAe,YAAf,eAAe,EACf,IAAgB,YAAhB,gBAAgB,EAChB,IAA0B,mBAC1B,IAAe,SAAf,kBAAe,EACf,IAAgB,UAAhB,kBAAgB,EAChB,IAAgB,qBAEwE,cAL9D,GAKtB,IAAU,WAAE,IAAe,gBAAE,IACP,cACnB,EAAY,GAAW,EAAe,cAAa,aACpD,EAAW,GAAW,EAAe,cAAY,YACzD,GAAgB,GAAwB,CAC5B,aACF,SAAG,EACI,kBACJ,cACF,YACD,WACG,YAAa,GAA6B,CAAnB,EAAa,EAAoB,EAAU,EAChE,cAAe,GAA+B,CAArB,EAAe,EAAsB,EAG7E,GAAU,EAAU,EAAY,aAChC,GAAmB,EAAc,eAhB7B,EAgBkC,EAAM,MAAW,SAAC,CACxD,GAAuB,EAAgB,EAAI,IAAK,YAAI,WAAuB,KAAW,EAAO,EAE7F,GAAe,EAAkB,EAAkB,EAAc,GAC1D,EAAM,MAAS,SAAiB,EACzC,IAAC,qMAlCqF,kCIIZ,cACxE,GAAmB,GAAS,OAAiB,iBAC7C,GAAgB,EAAgB,EAChC,WAAgB,EAAgB,EAChC,WAAmB,EACnB,KAAiB,EAAuB,KACrC,GAAW,GAA4B,QAAd,KAAgB,CAC1C,GAAU,GAAa,EAAM,MAA8B,2BAEpD,OADQ,EAAa,WAAO,EAAK,IAC1B,EAAM,IAClB,IAAQ,IACS,GAAQ,IACjB,MACR,IACK,KAAsB,IACV,EACd,GACc,GAAe,WAAc,EAAS,UAAW,EAAM,MAG5E,WACM,KACW,GAAG,CACnB,EACK,MAAC,CACK,aACK,kBACF,cAEjB,EAAC,gKC/ByB,iCCQwD,eAC1E,CAGF,IAAU,QAHA,SAAE,IAChB,SAAoB,EACpB,EAAS,EAAK,IACU,EAAV,EAAU,EAAV,IAAU,YAAnB,GAAK,KACR,GAAY,EAAI,EAAY,EACzB,GAAS,GAAY,EAAO,EACvB,MAAC,CAEN,EAAiB,EAAW,GAAY,EAAO,IACxC,IACQ,EACjB,GACe,GAAa,CAC9B,CACK,MACR,EAAC,KArBuE,cAEhE,MADH,GAAK,KAAG,QAAqB,EACtB,EAAY,YAAM,GAAM,MACpC,EAAC,MAoB6E,cACtE,QAAU,WAAE,IAAQ,SAAE,IAC5B,gBAAc,EAAqB,EAAW,EAC3C,GAAuB,CAAP,KACF,EAAG,IAAkB,KAAW,EAChD,IACD,GAAkB,GAAW,EAAa,EAAmB,EACvD,MACR,EAAC,UAnCD,GAAU,EAAW,SAAc,cACnC,UAAO,EAAS,EAAW,WAAQ,MAChC,EAAK,KAA2B,uCCAnC,iBA2EwC,YACtC,GAAS,GAAG,GAAY,GAAqB,GACvC,MAAsB,aACpB,MAAC,WAAU,QAAc,UAAd,YAAc,WAAd,eAAc,GAC7B,GAAO,GAAO,EAAI,IAAE,YAAI,SAAM,CAAC,GAAK,KACpC,KAAS,EAAQ,EAAQ,QACrB,GAIE,MAJO,KACN,EAAS,EAAM,MAAK,KAAQ,GAC5B,EAAQ,QAAI,EAClB,IAEH,CACF,CACF,CAAC,EAxFD,iBAKC,MAFmD,eAA/B,KAAG,IAAM,EAAS,KAAK,MAAQ,EAF3C,KAAK,MAA0C,KAC/C,KAAK,MAEZ,IAAC,CAGH,iBAOsC,aAAjB,gBAAiB,GAAjB,KAAK,MAAY,EAL7B,KAAI,KAAa,EACjB,KAAM,OAA0C,KAChD,KAAM,OAA0C,KAC/C,KAAM,OAAwC,GAGtD,IAAC,CA0DH,MAxDE,aAAK,MAAL,WACM,KAAO,OAAO,KAAO,OAAQ,KAC7B,KAAK,KAAK,EACV,KAAO,OACb,OAAC,EAED,YAAO,QAAU,YACX,GAAK,KAAO,OAAI,IAEnB,IACD,GAAS,GAAO,KAAO,OAAI,IAAO,GAC/B,GAAK,KAAO,SAAW,EAAE,CAC1B,GAAS,GAAQ,EACjB,MAAS,EAAQ,EAAO,MACnB,EAAM,MAAQ,KACd,EAAM,MAAO,KAAQ,OACtB,KAAQ,OAAM,MAAS,EACvB,KAAO,OAAS,EACd,EAAM,MACT,EAAS,IACL,EAAM,MAEV,GAAM,IAAS,KAAU,SACtB,KAAO,OAEf,EAAC,CACK,MAAM,GACd,MAAC,EAED,YAAO,QAAyB,cAC3B,GAAK,KAAQ,QAAM,GAAE,CACtB,GAAS,GAAO,KAAO,OAAI,IAAO,GAC7B,EAAM,MACb,CACI,KAAE,CACJ,GAAS,GAAG,GAAc,GAAkB,EAAS,GAClD,GAAC,CAAK,KAAM,OAAQ,KAAK,KAAO,KAAS,MACtC,KAEF,WAAE,CACJ,GAAc,GAAO,KAAQ,OACzB,KAAO,OAAc,EAAO,MAC5B,KAAQ,OAAM,MAAQ,KACtB,KAAO,OAAO,OAAY,EAChC,IAAC,CACI,EAAM,MAAO,KACf,OAAK,KAAU,SACZ,KAAO,OAAM,MAClB,GACG,KAAO,OACP,EAAK,KAAU,SACb,KAAO,OACZ,GACG,KAAO,OAAI,IAAI,EACrB,EACF,CAAC,EACF","file":"fancy-text-fill.js","sourcesContent":["import {\r\n  Options, AlgorithmParameters, fontInfo,\r\n  getLineHeightRatio, computeWidthHeightRatio, estimateHeight } from './helpers/index'\r\nexport { Options }\r\n\r\nexport function fillParentContainer(element: HTMLElement, opts: Options = {}): void {\r\n  // 1. Parse options\r\n  let {\r\n    minFontSize = 4,\r\n    maxFontSize = 40,\r\n    explicitLineHeight = false,\r\n    maxWidth = null,\r\n    maxHeight = null,\r\n    multiline = true\r\n  } = opts;\r\n  let { fontFamily, lineHeightRatio, maxLineHeight } = fontInfo(element, explicitLineHeight);\r\n  // 2. Apply defaulting rules\r\n  maxHeight = maxHeight || element.parentElement!.clientHeight\r\n  maxWidth = maxWidth || element.parentElement!.clientWidth\r\n  const algoParams: AlgorithmParameters = {\r\n    fontFamily,\r\n    fontSize: 0,\r\n    lineHeightRatio,\r\n    minFontSize,\r\n    maxHeight,\r\n    maxWidth,\r\n    maxFontSize: maxFontSize && Number(maxFontSize) > 0 ? maxFontSize : maxHeight,\r\n    maxLineHeight: maxLineHeight && Number(maxLineHeight) > 0 ? maxLineHeight : maxHeight,\r\n  }\r\n  // 3. tokenize text\r\n  const text = element.textContent || '';\r\n  const tokenizedText = multiline ? text.split(/(:? )/) : [text];\r\n  const widthHeightRatios = tokenizedText.map(text => computeWidthHeightRatio(fontFamily, text));\r\n  // 4. compute the optimal font-size!\r\n  let optimalSize = optimalFontSize(widthHeightRatios, algoParams);\r\n  element.style.fontSize = `${optimalSize}px`;\r\n}\r\n\r\nfunction optimalFontSize(wordRatios: number[], args: AlgorithmParameters): number {\r\n  let {\r\n    minFontSize,\r\n    maxHeight,\r\n    maxFontSize,\r\n    maxLineHeight,\r\n    maxWidth\r\n  } = args;\r\n  let low = Math.floor(minFontSize);\r\n  let high = Math.floor(Math.min(maxHeight, maxFontSize, maxLineHeight, ...wordRatios.map(r => maxWidth / r)));\r\n  if (low >= high || checkConstraints(wordRatios, {...args, fontSize: high})) {\r\n    return Math.max(low, high);\r\n  }\r\n  while (low < high && high - low > 1) {\r\n    const fontSize = (low + high) >>> 1;\r\n    if (checkConstraints(wordRatios, {...args, fontSize})) {\r\n      low = fontSize;\r\n    }\r\n    else {\r\n      high = fontSize;\r\n    }\r\n  }\r\n  return low;\r\n}\r\n\r\nfunction checkConstraints(wordRatios: number[], args: AlgorithmParameters): boolean {\r\n  let { maxHeight } = args;\r\n  let height = estimateHeight(wordRatios, args);\r\n  return height > 0 && height <= maxHeight;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.ts","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"fancyTextFill\"] = factory();\n\telse\n\t\troot[\"fancyTextFill\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"./\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 9);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 803d7c0fcd23ef68ea76","import { lru_cached } from '../lru';\r\nlet invisibleElement = document.createElement('div');\r\ninvisibleElement.style.position = 'absolute';\r\ninvisibleElement.style.top = '0px';\r\ninvisibleElement.style.left = '0px';\r\ninvisibleElement.style.visibility = 'hidden';\r\ninvisibleElement.style.height = 'auto';\r\ninvisibleElement.style.width = 'auto';\r\ninvisibleElement.style.zIndex = \"-9999\";\r\ninvisibleElement.innerText = \"h\";\r\n\r\ndocument.addEventListener('DOMContentLoaded', init);\r\nvar initialized = false;\r\n\r\nfunction init() {\r\n  if (!initialized) {\r\n    initialized = true;\r\n    document.body.appendChild(invisibleElement);\r\n  }\r\n}\r\n\r\nconst cachedGetLineHeightRatio = lru_cached(3000)((fontFamily: string, fontSize: number) => {\r\n  init();\r\n  invisibleElement.style.fontFamily = fontFamily;\r\n  invisibleElement.style.fontSize = fontSize + \"px\";\r\n  return invisibleElement.clientHeight / fontSize;\r\n});\r\n\r\nexport function getLineHeightRatio(fontFamily:string,fontSize :number): number {\r\n  return cachedGetLineHeightRatio(fontFamily, fontSize);\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/helpers/lineHeight.ts","export interface FontInfo {\r\n  fontFamily: string;\r\n  lineHeightRatio: number;\r\n  maxLineHeight: number | null;\r\n}\r\n\r\nexport function fontInfo(element: HTMLElement, explicitLineHeight: boolean): FontInfo {\r\n  const computedStyle = window.getComputedStyle(element);\r\n  const fontFamily = computedStyle.fontFamily!;\r\n  const lineHeight = computedStyle.lineHeight;\r\n  let lineHeightRatio: number | null= null;\r\n  let maxLineHeight: number | null = null;\r\n  if (lineHeight && lineHeight !== 'normal') {\r\n    let matchs = lineHeight.match(/^(\\d+(?:\\.?\\d+)?)(\\w*)$/) !;\r\n    lineHeightRatio = parseFloat(matchs[1]);\r\n    switch (matchs[2]) {\r\n      case '%':\r\n        lineHeightRatio /= 100;\r\n        break;\r\n      case 'px':\r\n        if (explicitLineHeight) {\r\n          maxLineHeight = lineHeightRatio;\r\n        }\r\n        lineHeightRatio /= parseFloat((computedStyle.fontSize || element.style.fontSize) !);\r\n        break;\r\n    }\r\n  }\r\n  else {\r\n    lineHeightRatio = -1;\r\n  }\r\n  return {\r\n    fontFamily,\r\n    lineHeightRatio,\r\n    maxLineHeight\r\n  };\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/helpers/fontInfo.ts","export * from './lineHeight'\r\nexport * from './options'\r\nexport * from './algorithmParameters'\r\nexport * from './widthsHeights'\r\nexport * from './fontInfo'\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/helpers/index.ts","import { AlgorithmParameters } from './algorithmParameters';\r\nimport { getLineHeightRatio } from './lineHeight'\r\n\r\nlet canvas = document.createElement('canvas');\r\nlet ctx = canvas.getContext('2d')!;\r\nctx.font = \"10px Arial,sans-serif\";\r\n\r\nexport function computeWidthHeightRatio(fontFamily: string, text: string): number {\r\n  ctx.font = `10px ${fontFamily}`;\r\n  return ctx.measureText(text).width / 10;\r\n}\r\n\r\nexport function estimateLinesCount(wordRatios: number[], args: AlgorithmParameters): number {\r\n  let { fontSize, maxWidth } = args;\r\n  let currentLineWidth = 0;\r\n  let lines = 1;\r\n  for (let r of wordRatios) {\r\n    let wordSize = r * fontSize;\r\n    if (wordSize >= maxWidth - 5) {\r\n      return -1;\r\n    }\r\n    if (currentLineWidth + wordSize >= maxWidth - 5) {\r\n      lines++;\r\n      currentLineWidth = 0;\r\n    }\r\n    currentLineWidth += wordSize;\r\n  }\r\n  return lines;\r\n}\r\n\r\nexport function estimateHeight(wordRatios: number[], args: AlgorithmParameters): number {\r\n  let { fontFamily, fontSize, lineHeightRatio } = args;\r\n  let linesCount = estimateLinesCount(wordRatios, args);\r\n  if (lineHeightRatio < 0) {\r\n    lineHeightRatio = getLineHeightRatio(fontFamily, fontSize)\r\n  }\r\n  let computedHeight = fontSize * linesCount * lineHeightRatio;\r\n  return computedHeight;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/helpers/widthsHeights.ts","/** \r\n * @todo put this in a separate package \r\n */\r\nexport type NullableCacheEntry<TKey, TValue> = CacheEntry<TKey, TValue> | null;\r\n\r\nexport class CacheEntry<TKey, TValue> {\r\n  public older: NullableCacheEntry<TKey, TValue> = null;\r\n  public newer: NullableCacheEntry<TKey, TValue> = null;\r\n  constructor(public key: TKey, public value: TValue) {\r\n  }\r\n}\r\n\r\nexport class LRUCache<TKey extends string | number, TValue> {\r\n  /* double linked list */\r\n  public size: number = 0;\r\n  public oldest: NullableCacheEntry<TKey, TValue> = null;\r\n  public newest: NullableCacheEntry<TKey, TValue> = null;\r\n  private keymap: Map<TKey, CacheEntry<TKey, TValue>> = new Map<TKey, CacheEntry<TKey, TValue>>();\r\n\r\n  constructor(public limit: number = 0) {\r\n  }\r\n\r\n  clear() {\r\n    this.oldest = this.newest = null;\r\n    this.size = 0;\r\n    this.keymap.clear();\r\n  }\r\n\r\n  getItem(key: TKey): TValue | undefined {\r\n    if (!this.keymap.has(key)) {\r\n      return undefined;\r\n    }\r\n    let entry = this.keymap.get(key)!;\r\n    if (this.newest !== entry) {\r\n      let older = entry.older;\r\n      let newer = entry.newer;\r\n      entry.newer = null;\r\n      entry.older = this.newest;\r\n      this.newest!.newer = entry;\r\n      this.newest = entry;\r\n      newer!.older = older;\r\n      if (older) {\r\n        older.newer = newer;\r\n      }\r\n      if (entry === this.oldest) {\r\n        this.oldest = newer;\r\n      }\r\n    }\r\n    return entry.value;\r\n  }\r\n\r\n  setItem(key: TKey, value: TValue) {\r\n    if (this.getItem(key)) {\r\n      let entry = this.keymap.get(key)!;\r\n      entry.value = value;\r\n    }\r\n    else {\r\n      let entry = new CacheEntry<TKey, TValue>(key, value);\r\n      if (!this.limit || this.size < this.limit) {\r\n        this.size++;\r\n      }\r\n      else {\r\n        let firstEntry = this.oldest;\r\n        this.oldest = firstEntry!.newer;\r\n        this.oldest!.older = null;\r\n        this.keymap.delete(firstEntry!.key);\r\n      }\r\n      entry.older = this.newest;\r\n      if (this.newest) {\r\n        this.newest.newer = entry;\r\n      }\r\n      this.newest = entry;\r\n      if (!this.oldest) {\r\n        this.oldest = entry;\r\n      }\r\n      this.keymap.set(key, entry);\r\n    }\r\n  }\r\n}\r\n\r\nexport function lru_cached(limit: number) {\r\n  let cache = new LRUCache<string, any>(limit);\r\n  return function (target: any) {\r\n    return function (...args: any[]) {\r\n      let key = args.map(v => `${v}`).join(';');\r\n      let value = cache.getItem(key);\r\n      if (!value) {\r\n        value = target.apply(this, args);\r\n        cache.setItem(key, value);\r\n      }\r\n      return value;\r\n    }\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/lru/index.ts"],"sourceRoot":""}